# cloud-object-malware-scanner
Scan a cloud storage buckets objects for malware

cloud-object-malware-scanner is a go RESTful API designed to scan objects uploaded to GCP and AWS storage buckets for malware. It performs scans async, is concurrent, and provides scan results via 
a redis pubsub. 

## Installation

1. run `docker-compose up -d`
2. Use a postgres client to log into the container db to obtain client ID
3. Create a free https://metadefender.opswat.com/ account and obtain an API key
4. Create a move `env_schema` to `.env` and update the variables. 

---
#### Health Check Endpoint `GET /v1/health`
##### Request Headers
`x-api-key: string [required]`

`x-client-id: string [required]`

---
####  File Scan Endpoint `POST /v1/scan`
##### Request Headers
`x-api-key: string [required]`

`x-client-id: string [required]`
##### Request Body `application/json`
```JSONC
{
    "object_name": "string [required]",         // Can be prefixed
    "storage_bucket_name": "string [required]",
    "cloud_provider": "string [required]",      // Only supports "gcp" or "aws" values
    "object_identifier": "string [optional]".   // An ID included in scan results
                                                // for the callers tracking purposes
}
```

##### 200 Response Body `application/json`
None, a 200 status code will be the only response. 

##### 400 Bad Request Response Body `application/json`
```json
{
    "status": false,
    "message": "{a comma separated string of required fields missing from your request}",
}
```

##### 401 Unauthorized Response Body `application/json`
```JSONC
// If required headers are missing:
{
    "status": false,
    "message": "{a comma separated string of required headers missing from your request}",
}

// If auth credentials are invalid:
{}
```

##### 405 Method No Allowed Response Body `application/json`
```json
{}
```

##### 500 Server Error Response Body `application/json`
```json
{}
```

## Getting Scan Results
All scan results are published async to a redis pubsub channel. You can use the redis subscription tool in `/tools/sub/sub.go` to listen for messages.

A published scan result message is in this format:

```JSONC
{
    "scan_object": "string",         // The objects bucket and name
    "scan_result_str": "string",     // The malware scan result in human readable form. 
                                     // It will either be `Clean` or `Infected`. 
    "scan_result_int": "int",        // An ID given to a scan result. 0 is clean, 1 is Infected.
    "error": "string",               // If a scan error occurred, reason will be here.
    "object_identifier": "string",   // The ID sent in the original request. 
    "client_id": "string"            // The assigned client ID
    "scan_id": "string"              // A unique ID tied to a particular scan. 
    "message" string                 // Some descriptive message
    "poll_id": string                // Future use case when client side polling for results is enabled
}
```
